<?xml version="1.0" encoding="utf-8"?>
<odoo noupdate="1">

    <record id="invoiced_ticket_request_email_template" model="mail.template">
        <field name="name">Ticket: Invoiced</field>
        <field name="model_id" ref="helpdesk.model_helpdesk_ticket"/>
        <field name="subject">${object.display_name}</field>
        <field name="email_from">${(object.user_id.email_formatted or user.email_formatted) | safe}</field>
        <field name="email_to">${(object.partner_email if not object.sudo().partner_id.email or object.sudo().partner_id.email != object.partner_email else '') | safe}</field>
        <field name="partner_to">${object.partner_id.id if object.sudo().partner_id.email and object.sudo().partner_id.email == object.partner_email else ''}</field>
        <field name="body_html" type="xml">
<div>
    % set repair = object.fsm_task_ids.repair_id
    Dear ${object.sudo().partner_id.name or 'Madam/Sir'},<br /><br />
    This automatic message informs you that we have invoiced your ticket ${object.name}.<br />
    % if repair.name:
    The repair order: ${repair.name} has been closed and invoiced correctly.<br /><br />
    % endif
    Kind regards,<br /><br />
    ${object.team_id.name or 'Helpdesk'} Team.
</div>
        </field>
        <field name="lang">${object.partner_id.lang or object.user_id.lang or user.lang}</field>
        <field name="auto_delete" eval="False"/>
    </record>

</odoo>
